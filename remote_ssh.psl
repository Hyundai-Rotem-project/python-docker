# ê³ ì •ëœ ì ‘ì† ì •ë³´
$remoteHost = "192.168.191.60"  # B ì„œë²„ IP (ì˜ˆ: ZeroTier IP)
$remotePort = 2222              # SSH í¬íŠ¸
$remoteUser = Read-Host "Enter remote username"

# SSH í‚¤ ê²½ë¡œ
$sshDir = "$env:USERPROFILE\.ssh"
$privateKey = "$sshDir\id_rsa"
$publicKey = "$privateKey.pub"

# SSH í‚¤ê°€ ì—†ë‹¤ë©´ ìƒì„±
if (-Not (Test-Path $privateKey)) {
    Write-Host "ğŸ” SSH í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤..."
    ssh-keygen -t rsa -b 4096 -f $privateKey -N "" | Out-Null
    Write-Host "âœ… í‚¤ ìƒì„± ì™„ë£Œ!"
} else {
    Write-Host "âœ… ê¸°ì¡´ SSH í‚¤ ì‚¬ìš© ì¤‘."
}

# ê³µê°œí‚¤ë¥¼ ì›ê²© ì„œë²„ì— ë“±ë¡
Write-Host "ğŸš€ ê³µê°œí‚¤ë¥¼ B ì„œë²„ì— ë“±ë¡ ì¤‘..."

# SSH ì—°ê²° ëª…ë ¹ êµ¬ì„±
$pubkeyContent = Get-Content $publicKey
$escapedKey = $pubkeyContent -replace "`n", ""

$sshCommand = "mkdir -p ~/.ssh && chmod 700 ~/.ssh && echo '$escapedKey' >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"

# ssh ëª…ë ¹ ì‹¤í–‰
ssh -p $remotePort "$remoteUser@$remoteHost" $sshCommand

Write-Host "ğŸ‰ ì™„ë£Œ! ì´ì œ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
